# 三角机构模块（Triangle Agency跑团专用插件+人物卡模板）

- **名称**​：三角机构模块
- ​**作者**​：Desom-fu
- ​**版本**​：1.1.0
- ​**兼容版本**​：理论兼容所有版本，但仅在最新版本测试过
- ​**平台**​：理论支持全平台（仅在 QQ 部署测试过）
- ​**操作系统**​：理论支持全系统（仅在 Windows Server 2019 上部署过）
- **前置插件**：OlivaDiceCore
- **三角机构群号**：1056836484

---

## 注意事项

- 建议使用最新构建版`OlivaDice`以获得最佳体验
- 下载链接：[点这里进行下载](https://www.123865.com/s/RmRmjv-rTqW?pwd=oliv#)，提取码`oliv`

- 下载完毕后建议打开`OlivaDice 设置面板`的自定义回复，在回复词中的`配置恢复模块`里面新增一行`OlivaDiceTA`（注意大小写要完全一致!）

---

## 下载

- ###### ​**插件包（记得解压！）** ​:
[upl-file uuid=ca1f749a-19ee-4e3b-b6ba-c5054825f867 size=15kB]olivadiceta.zip[/upl-file]

- ###### **三角机构青果专用人物卡模板（解压！）** :
[upl-file uuid=3851638d-e90e-48ee-8383-6e4fa2db56e1 size=915B]ta.zip[/upl-file]

---

## 更新日志

## 2025.12.9 青果骰三角机构插件v1.1.0重大更新
### 新增功能
- **新增D20资质检定系统**：
  - 新增 `.tra <资质/表达式>` 命令进行D20资质检定
  - 支持技能值和表达式（如 `.tra 专注+5`、`.tra 1d6+专注`）
  - D20=3触发【三重升华】大成功，不产生混沌值
  - D20=7触发【命定失败】，将表达式中的技能归零
  - 失败时产生等于D20结果的混沌值（可用c参数禁用）

- **新增D10检定模式**：
  - 新增s参数启用D10模式：`.tas`、`.trs`
  - D10结果 = 3的数量 = 混沌值（D10=3时为失败，0个3，3点混沌）
  - 不支持三重升华和三角稳定机制
  - 过载机制：可燃掉D10的3，每次过载+1混沌
  - 支持与D6增益同时使用：`.tasg专注`

- **新增D6增益骰系统**：
  - 新增g参数投掷D6增益骰（原d参数改为g以避免混淆）
  - D6=3: 增加1个3，0点混沌
  - D6=6: 增加2个3，0点混沌
  - 其他: 增加0个3，1点混沌
  - D6增益的3可被过载燃掉，优先燃掉D6增益的3
  - 在D10模式(s参数)中，D10=3时D6增益无效
  - 支持6D4和D10模式：`.tag`、`.tasg`

### 功能优化
- **过载显示增强**：
  - 新增详细的过载信息显示
  - 6D4模式：显示 "本次投出了X个3，过载Y个，剩下Z个3"
  - D10模式：显示D10和D6增益分别的燃尽情况
  - 示例：`D10: 6 (燃尽1->5)` 或 `D6增益: 3 -> +1个3(燃尽1->0)`
  - D10=3(失败)时不显示过载信息
  
- **3的计数显示优化**：
  - 普通情况：显示最终3的数量
  - 有过载时：显示详细的过载前后变化
  - 三重升华时：显示原始3的数量

- **人物卡模板优化**：
  - 优化人物卡模板结构和显示

## 2025.12.1 青果骰三角机构插件v1.0.7更新
- 修复一些显示bug

## 2025.11.20 三角机构青果插件v1.0.6更新
- 显示译名同步正式版译名（如处分->申诫，坚持->坚毅，过载->过载等），但是保持了兼容性（使用原译名仍然生效）
- 现在使用.sn会在群名片显示当前嘉奖和申诫
- 同步最新构建ovo版本

## 2025.11.11 V1.0.5更新
- 追至最新版本ovo构建版
- 更改构建版本

## 2025.11.10 v1.0.4
- 推进至最新构建版OlivaDice
- 修复过载计算相关的bug

## 2025.10.13 v1.0.3更新：
- 修复一些掷骰bug，推进到最新构建版olivadicecore

## 2025.9.22 v1.0.2 更新：
- 向上兼容暂未更新的新版OlivOS-0.11.66(186)-玄铁古剑及以上的版本，向上兼容at回复，若不更新这个版本暂时可以无视，不过建议更新

## 2025.9.19 v1.0.1更新：
- 优化自定义回复默认项和显示项

## 2025.9.18 v1.0.0发布：
- 三角机构插件发布
- 支持完整的三角机构检定系统
- 包含过载机制和混沌值系统
- 支持现实改写检定和失败追踪
- 自动处理三重升华和三角稳定判定
- 支持表达式系统和技能值替换
- 支持代投功能和权限管理

---

## 核心功能

### 检定系统
- **6D4标准检定**：
  - `.ta <属性/表达式>` - 三角机构技能检定
  - `.tr <属性/表达式>` - 现实改写检定
  - 支持多次检定：`.ta3#专注` 进行3次专注检定
  
- **D10简化检定** (s参数)：
  - `.tas <属性>` - D10简化检定
  - `.trs <属性>` - D10现实改写检定
  - D10结果 = 3的数量 = 混沌值
  - D10=3时为失败，0个3，但产生3点混沌
  - 不支持三重升华和三角稳定
  
- **D20资质检定**：
  - `.tra <资质/表达式>` - D20资质检定
  - 支持表达式：`.tra 专注+5`、`.tra 1d6+专注`
  - D20=3: 三重升华大成功（不产生混沌）
  - D20=7: 命定失败（技能归零）
  - 总结果>10: 成功，否则失败
  - 失败时产生等于D20结果的混沌值
  - 支持多次检定：`.tra3#专注`

### 参数系统
- **通用参数**：
  - `c` - 不产生混沌值
  - `f` - 不消耗现实改写失败次数（仅.tr/.trs）
  - `b数字` - 奖励骰子（强制将指定数量的非3改为3）
  - `p数字` - 惩罚骰子（强制将指定数量的3改为非3）
  - `s` - D10简化模式（仅.ta/.tr）
  - `g` - D6增益骰（所有检定模式）

- **D6增益骰** (g参数)：
  - D6=3: +1个3，0点混沌
  - D6=6: +2个3，0点混沌
  - 其他: +0个3，+1点混沌
  - D6增益的3可被过载燃掉
  - 支持与s参数同时使用：`.tasg`

- **参数示例**：
  - `.ta b2专注` - 两个奖励骰
  - `.ta p1专注` - 一个惩罚骰
  - `.tac专注` - 不产生混沌值
  - `.tag专注` - 使用D6增益骰
  - `.tasg专注` - D10模式+D6增益
  - `.tracf专注` - D20检定，无混沌无失败

### 状态管理
- 新增 `.tcs` 命令，用于管理群组混沌值
  - `.tcs` - 查看当前混沌值
  - `.tcs 数值` - 设置混沌值
  - `.tcs +数值` - 增加混沌值
  - `.tcs -数值` - 减少混沌值
  - 支持表达式：`.tcs 1d6+2`、`.tcs 力量/2`
  
- 新增 `.tfs` 命令，用于管理现实改写失败次数
  - `.tfs` - 查看当前失败次数
  - `.tfs 数值` - 设置失败次数
  - `.tfs +数值` - 增加失败次数
  - `.tfs -数值` - 减少失败次数
  - 支持表达式：`.tfs 1d3`、`.tfs 智力/10`

### 代投功能
- 支持管理员代投：`.ta 属性名 @用户`
- 支持多次代投：`.ta3#专注 @用户`
- 自动识别目标用户的人物卡数据

---

## 游戏机制详解

### 基础检定规则
- **骰子系统**：投掷6D4，统计结果中3的个数
- **成功判定**：
  - 0个3：失败
  - 出现3：成功
  - 3个3：特殊情况（见下文）

### 特殊机制
- **三重升华**：原始骰子就有3个3 → 大成功，不产生混沌值
- **三角稳定**：经过修正后恰好3个3 → 成功，不产生混沌值
- **过载效果**：属性值≤0时产生过载，将骰子中的3强制改为非3
- **混沌生成**：根据公式 `6 - 最终3的个数 + 过载次数 + 惩罚次数` 计算

### 现实改写系统
- **现实改写检定**：使用`.tr`命令进行
- **失败惩罚**：.tr检定失败时增加现实改写失败次数
- **过载叠加**：现实改写失败次数会增加.tr检定的过载值

---

## 使用示例

```
# 6D4标准检定
.ta 专注          # 使用专注属性进行检定
.tr 共情          # 现实改写检定

# D10简化检定
.tas 专注         # D10简化检定
.trs 共情         # D10现实改写检定
.tasg 专注        # D10+D6增益

# D20资质检定
.tra 专注         # D20资质检定
.tra 专注+5       # D20检定，资质+5
.tra 1d6+专注     # D20检定，1d6+专注
.tra3#专注        # 3次D20检定

# 参数检定
.ta b2专注        # 两个奖励骰
.ta p1专注        # 一个惩罚骰
.tag专注          # D6增益骰
.tasg专注         # D10+D6增益
.tac专注          # 不产生混沌值
.trcf共情         # 现实改写，无混沌无失败

# 多次检定
.ta3#专注         # 3次6D4检定
.tas2#共情        # 2次D10检定
.tra3#专注        # 3次D20检定
.trc2#共情        # 2次现实改写，不产生混沌值

# 代投
.ta 专注 @小明    # 为小明进行6D4检定
.tas 专注 @小明   # 为小明进行D10检定
.tra 专注 @小明   # 为小明进行D20检定
.ta3#共情 @小明   # 为小明进行3次检定

# 状态管理
.tcs              # 查看混沌值
.tcs 10           # 设置混沌值为10
.tcs +1d6         # 增加1d6点混沌值
.tcs -专注        # 减少等于专注属性的混沌值

.tfs              # 查看现实改写失败
.tfs +1           # 增加1次失败
.tfs 10           # 设置失败次数为10
```

---

## 安装指南

1. **下载插件**：下载OlivaDiceTA插件包并解压
2. **安装插件**：将插件文件夹放入OlivOS的plugin目录
3. **配置回复**：在设置面板的自定义回复中添加`OlivaDiceTA`
4. **导入模板**：将ta.json放入人物卡模板目录

---

## 常见问题

**Q: 为什么投出6个3还是成功而不是大成功？**
A: 只有原始骰子就有3个3才是真正的三重升华大成功。通过奖励骰子等方式获得的3个以上3，按普通成功处理。

**Q: 三角稳定是什么？**
A: 当原始骰子不是3个3，但经过各种修正后变成恰好3个3时，触发三角稳定，显示为成功且不产生混沌值。

**Q: 过载是如何计算的？**
A: 过载值 = 属性过载 + 现实改写失败过载(.tr时)，其中属性过载 = 1。

**Q: 混沌值什么时候增加？**
A: 除了三重升华和三角稳定外，其他情况都会根据公式产生混沌值：6 - 最终3的个数 + 过载次数 + 惩罚次数。

**Q: D10模式和6D4模式有什么区别？**
A: D10模式(s参数)是简化模式，D10结果直接等于3的数量和混沌值。D10=3时为失败(0个3，但产生3点混沌)。D10模式不支持三重升华和三角稳定。

**Q: D6增益骰(g参数)怎么用？**
A: g参数会额外投掷1D6。D6=3时增加1个3，D6=6时增加2个3，其他结果增加1点混沌。D6增益的3可以被过载燃掉，且优先燃掉D6的3。

**Q: D20资质检定(.tra)的判定规则是什么？**
A: 投1D20+资质值，总结果>10为成功。特殊规则：D20=3为三重升华大成功(不产生混沌)，D20=7为命定失败(技能归零)。失败时产生等于D20结果的混沌值。

**Q: 为什么D10=3时，D6增益显示"无效"？**
A: D10=3时是必定失败，此时任何增益都无法改变结果，所以D6增益无效。

**Q: 过载燃掉的3是如何显示的？**
A: 系统会详细显示过载情况，例如"D10: 6 (燃尽1->5)"表示D10投出6，被燃掉1个3，剩余5个3。D6增益同理。

---

## 联系与反馈

如有问题或建议，请联系作者：Desom-fu

---

## 使用截图
![Image description](https://forum.olivos.run/assets/files/2025-12-09/1765263018-691829-dd6135f81f28c0e634ebb4e12759ef31.png)
![Image description](https://forum.olivos.run/assets/files/2025-12-09/1765263039-176404-9db2ac895ca561fa15e70e5480c67f66.png)