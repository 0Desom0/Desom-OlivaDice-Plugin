- **名称**：`QQ群消息转发`
- **作者**：`Desom-fu`
- **版本**：`1.0.0`
- **兼容版本**：`理论兼容所有 3.0 以上的 OlivOS 版本`
- **平台**：`理论支持全平台（仅在 QQ/OneBot 环境部署测试）`
- **前置插件**：`可选：OlivaDiceCore（用于骰主判定与人物卡显示；未安装也可用但相关功能自动失效）`

---

## 简介

用于 QQ 多群“链接转发”的插件，支持：

- **单向链接**：在“本群”执行命令，把“对面群”的消息**单向转发到本群**（对面 → 本群）。
- **双向链接**：两边消息互相转发（A ↔ B）。
- **一对多 / 多对一**：一个群可连接多个群；多个群也可连接到同一个群（自动去重，禁止重复连接）。
- **权限体系**：
  - 群链管理：群主 / 群管 / 骰主 / 配置 master
  - 双向链接额外限制：非骰主/配置 master 时，必须你在两边都是群主/管理员
  - 全局开关、人物卡开关：仅骰主

转发模板：

- 默认：

```
[群昵称(群号) - 昵称(QQ号)]
消息内容
```

- 开启“人物卡显示”且检测到 OlivaDiceCore：

```
[群昵称(群号) - 人物卡[昵称](QQ号)]
消息内容
```

---

## 下载

- ### 插件包：

`QQGroupForward.opk`

（论坛发布时可替换成你的上传链接/附件，比如：
`[upl-file uuid=... size=... ]QQGroupForward.opk[/upl-file]`
）

---

## 注意事项

- **对面群必须在 bot 的群列表里**：也就是 bot 必须已加入对面群（插件通过拉群成员列表验证）。
- **操作者本人也必须在对面群内**：否则不允许建立链接。
- **不会转发 bot 自己发送的消息**（避免回环）。
- 若未安装 `OlivaDiceCore`：
  - “骰主判定”与“人物卡显示”会自动不可用（即便配置为开启也视为关闭）。
- 转发内容会尽量按原消息文本转发（包含 CQ/OP 码的文本也会原样带过去），不同平台/实现可能存在兼容差异。

---

## 命令总览（前缀：`.群链` / `。群链` / `/群链`）

### 链接管理

- `.群链 单向 [对面群号]`：建立单向（对面 → 本群）
- `.群链 双向 [对面群号]`：建立双向（A ↔ B）
- `.群链 断开 单向 [对面群号]`：断开单向（对面 → 本群）
- `.群链 断开 双向 [对面群号]`：断开双向（A ↔ B）
- `.群链 列表`：查看本群连接（会同时显示“接收”和“发送”两类连接）

### 防刷（去重）开关

- `.群链 防刷 开/关/状态`：开关“消息ID去重”（权限：骰主 / 配置 master）

### 全局转发开关（仅骰主）

- `.群链 全局 开/关/状态`：全局启用/禁用消息转发（命令仍可用，便于再开启）

### 人物卡显示（仅骰主，需 OlivaDiceCore）

- `.群链 人物卡 开/关/状态`：全局开关人物卡显示（默认开；无 OlivaDiceCore 时不可用）

---

## 配置说明

配置文件（自动生成）：

- `plugin/data/QQGroupForward/default.json`

常用字段：

- `global_enabled`：全局转发总开关
- `pc_card_enabled`：人物卡显示开关（需 OlivaDiceCore）
- `dedup_enabled` / `dedup_ttl_sec`：防刷去重开关与 TTL
- `masters`：配置 master 列表（权限等同骰主用于群链管理/防刷开关，但**不能**操作“全局/人物卡开关”）
- `edges`：路由表（有向边）：`src_group -> [dst_group, ...]`

---

## 使用示例

在“接收群”里执行：

```
.群链 单向 123456789
```

含义：把 `123456789` 群的消息转发到当前群。

建立双向：

```
.群链 双向 123456789
```

查看连接：

```
.群链 列表
```

---

## 安装

1. 将 `QQGroupForward.opk` 放入 OlivOS 插件目录：`YourOlivOSPath/plugin/app`。
2. 重载插件。
3. 在需要接收转发的群里使用 `.群链 ...` 配置链接。

---

## 更新日志

### 2026.1.30 v1.0.0

- 初版发布：单向/双向群链、一对多/多对一、去重防刷、全局开关、人物卡显示（需 OlivaDiceCore）。
